define("ds2-page-tron-tracking",[],(function(){return function(){var e={924:function(e,t,n){"use strict";n.r(t),n.d(t,{getDataLayerFromApi:function(){return o},getDataLayerFromSources:function(){return r},extractFrmPageDL:function(){return i},getDL:function(){return s},evaluateDLPath:function(){return c},datalayerPath:function(){return g},getFirstFunctionWithValue:function(){return p},gFFWNV:function(){return d},determineBrand:function(){return m},buildPageObj:function(){return f},convertToACDL:function(){return l}}),window.TRON=window.TRON||{},TRON.isInitialized||function(){var e=console.error,t=console.info,n=console.warn;function a(){return-1!=document.location.search.indexOf("trondebug=true")||null!=sessionStorage.getItem("tronDebug")&&"true"===sessionStorage.getItem("tronDebug")}console.error=function(){if("object"==typeof arguments[0]&&(arguments[0]=arguments[0].toString()),void 0!==arguments[0]&&arguments[0].indexOf("Incorrect TRON implementation: â›”")>-1){var t=arguments[0].split("Incorrect TRON implementation: â›”")[1],n={E001:"parameter is missing",E002:"value is incorrect",E003:"value is empty",E004:"does not exist"},o=Object.entries(n).find((([e,n])=>t.includes(n)));o=o?o[0]:"Unknown error",window.adobeDataLayer=window.adobeDataLayer||[];let e=TRON.dataComponent;var r="undefined"!=typeof prefix?prefix:TRON.prefix,i={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},s=void 0!==i[r]?i[r]:((((this.message||"").component||"")[0]||"").category||"").primaryCategory||"";if(""==s||"shared > "==r||"local > "==r){var c=[".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com"],g=c.some((e=>window.location.href.includes(e)));if(g)if([".bmw.com"].some((e=>window.location.href.includes(e)))){var p=window.location.pathname.split("/");void 0!==p[1]&&"nsc website"==(s=p[1].indexOf("-")>-1?"nsc website":"special website")&&(r="nsc > ")}else s="special website",r="special > ";else s="special website",r="special > "}"undefined"!=typeof prefix&&(prefix=r),void 0!==TRON.prefix&&(TRON.prefix=r);let a={},d="";void 0!==e&&(e[0].category.primaryCategory=s,d=e[0].componentInfo.componentID,a[d]=e[0]),window.adobeDataLayer.push({component:a,version:TRON.version,event:"tron event",eventInfo:{cause:"TRON implementation > "+((TRON||"").currentEventName||""),effect:TRON.prefix+t,eventAction:"trigger tron function",eventName:"error",eventPoints:0,timeStamp:(new Date).getTime(),type:"frontend component",category:{primaryCategory:(TRON||"").componentName||"",subCategory1:o,subCategory2:"TRON library"},reference:{linkedComponent:d}}})}a()&&e.apply(this,arguments)},console.info=function(){a()&&t.apply(this,arguments)},console.warn=function(){a()&&n.apply(this,arguments)}}();const a={customeEventName:"TRON: enhanced activity map",libraryName:"enhanced activity map",libraryVersion:"_v3.1.19",prefix:"nsc > ",pageExist:!0};function o(){const e=window.digitals2&&window.digitals2.tracking&&window.digitals2.tracking.api;if(void 0!==e){const t=e.getCurrentPageIndex();let n;for(let n=t;n>0;n--)if("object"==typeof e.getPageObject(n).page&&"VCO"==e.getPageObject(n).page.category.primaryCategory){t=n;break}if(n=e.getPageObject(t),void 0!==n.pageInstanceId&&""!=n.pageInstanceId&&-1==n.pageInstanceId.indexOf("need-analyzer"))return n;if(void 0!==n.component&&n&&n.component[0]&&n.component[0].category&&"stock locator"==n.component[0].category.subCategory01)return n;if(void 0!==n.component&&n&&n.component[0]&&n.component[0].componentInfo&&"digital checkout solution"==n.component[0].componentInfo.componentName)return n;if(void 0!==n.pageInstanceId&&""!=n.pageInstanceId&&n.product.length>0)return n;if(void 0!==n.pageInstanceId&&""!=n.pageInstanceId)return t&&t>0?(n=e.getPageObject(t),n):(n=e.getPageObject(0),n)}}function r(){return d([o,()=>{if("undefined"!=typeof BMWdataLayer)return JSON.parse(JSON.stringify(BMWdataLayer))},()=>{if("undefined"!=typeof mnm&&""!=((((mnm||"").mnmnsc||"").page||"").currentPage||"")&&void 0!==mnm.mnmnsc.page.currentPage.getTrackingService)return mnm.mnmnsc.page.currentPage.getTrackingService().getDigitalData()},()=>{if("undefined"!=typeof datalayer_localForms){const e=(datalayer_localForms||"").event||[];if(e.length>0)return e[e.length-1]}},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.digitalData&&window.dataLayer){const e=digital.tracking.getInstance(window.dataLayer),t=e.getCurrentPageIndex()||0,n=e.getPageObject(t);if("object"==typeof n&&0==Object.keys(n).length&&void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;if(""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0)return window.dataLayer.pages[e]}return JSON.parse(JSON.stringify(n))}},()=>{if(void 0!==window.h5vco&&""!=((window.h5vco||"").digitalData||""))return window.h5vco.digitalData},()=>{if(void 0!==window.dcsDataLayer&&""!=((window.dcsDataLayer||"").pages||"")){const e=window.dcsDataLayer.activePageIndex||0;return window.dcsDataLayer.pages[e]}},()=>{if(void 0!==window.dataLayer&&void 0!==window.dataLayer.activePageIndex){const e=window.dataLayer.activePageIndex||0;return""!=((window.dataLayer||"").pages||"")&&window.dataLayer.pages.length>0?window.dataLayer.pages[e]:window.dataLayer}},()=>{if(void 0!==window.digitalData)return JSON.parse(JSON.stringify(window.digitalData))},()=>{if(window.digital&&window.digital.tracking&&"function"==typeof window.digital.tracking.getInstance&&void 0===window.dataLayer){const e=digital.tracking.getInstance(),t=e.getCurrentPageIndex()||0,n=e.getPageObject(t);return JSON.parse(JSON.stringify(n))}}],{})}function i(){try{return r()||""}catch(e){return""}}function s(e,t){try{for(var n=(e=e||"").split("."),a=i(),o=0;o<n.length&&null!=a;o++)null!=n[o]&&""!=n[o]&&(a=Array.isArray(a)&&/-[0-9]+/.test(n[o])?a[a.length-Math.abs(parseInt(n[o]))]:a[n[o]]);return"string"==typeof a&&["","na","not set","n/a","not available","not yet available","not selected","unknown"].indexOf(a.toLowerCase())>-1?t:a||t||""}catch(e){return""}}function c(e){return""!=s(e)&&void 0!==s(e)?s(e):""}function g(e){return""!=s(e)&&void 0!==s(e)?s(e):void 0}function p(e,t){for(let n of e)try{const e=n.apply(this,[t]);if(void 0!==e&&(!t||!t.isValid||t.isValid(e)))return e}catch(e){}}function d(e,t={}){return p(e,t.isValid?t:Object.assign(t,{isValid:e=>!!e}))}function m(){return d([()=>g("page.attributes.brand"),()=>window.location.hostname.indexOf("bmw-motorrad")>-1&&"motorrad",()=>window.location.hostname.indexOf("bmw")>-1&&"bmw",()=>window.location.hostname.indexOf("mini")>-1&&"mini",()=>window.location.hostname.indexOf("rolls-royce")>-1&&"rolls-royce"])||""}function f(){var e=JSON.parse(JSON.stringify(g("page.attributes")||""))||{};return e.brand=m(),e.pageTitle=d([()=>g("page.title"),()=>g("page.pageInfo.pageTitle"),()=>document.title]),e.timeZone=d([()=>g("page.attributes.timeZone")]),{attributes:JSON.parse(JSON.stringify(e)),category:{pageType:d([()=>g("page.category.pageType"),()=>g("page.category.formType"),()=>g("page.category.primaryTags")]),primaryCategory:d([()=>"NBC"==g("page.attributes.template")&&"configurator",()=>"object"==typeof g("page.category.primaryTags")&&g("page.category.primaryTags.0"),()=>void 0!==g("pageInstanceId")&&g("pageInstanceId").split("/")&&g("pageInstanceId").split("/").length>1&&"all-models"==g("pageInstanceId").split("/")[6]&&g("pageInstanceId").split("/")[6].length>8&&"showroom",()=>8==g("pageInstanceId").split("/")[6].length&&"series overview",()=>g("page.pageHier"),()=>g("page.category.subCategory01"),()=>g("page.category.primaryCategory"),()=>g("page.primarySection"),()=>g("page.category.primaryTags"),()=>"homepage"]),subCategory1:d([()=>"object"==typeof g("page.category.secondaryTags")&&g("page.category.secondaryTags.0"),()=>void 0!==g("pageInstanceId")&&g("pageInstanceId").split("/")&&g("pageInstanceId").split("/").length>1&&void 0!==g("pageInstanceId").split("/")[7]&&g("pageInstanceId").split("/")[7],()=>g("page.pageLevel2"),()=>g("page.category.subCategory01"),()=>g("page.category.purchaseReason"),()=>g("page.category.subCategory1"),()=>"content"]),subCategory2:d([()=>void 0!==g("pageInstanceId")&&g("pageInstanceId").split("/")&&g("pageInstanceId").split("/").length>1&&void 0!==g("pageInstanceId").split("/")[8]&&g("pageInstanceId").split("/")[8],()=>g("page.pageLevel3"),()=>g("page.category.subCategory02"),()=>g("page.category.subCategory2")]),subCategory3:d([()=>void 0!==g("pageInstanceId")&&g("pageInstanceId").split("/")&&g("pageInstanceId").split("/").length>1&&void 0!==g("pageInstanceId").split("/")[9]&&g("pageInstanceId").split("/")[9],()=>g("page.pageLevel4"),()=>g("page.category.subCategory03"),()=>g("page.category.subCategory3")])},pageInfo:{author:g("page.pageInfo.author"),destinationURL:d([()=>g("page.url"),()=>g("page.pageInfo.destinationUrl"),()=>g("page.pageInfo.destinationURL")]),geoRegion:d([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>g("page.pageInfo.geoRegion"),()=>g("page.pageInfo.language").indexOf("-")>-1&&g("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":""]),language:d([()=>g("page.pageInfo.language").slice(0,2)||(g("page.pageInfo.language").indexOf("-")>-1?g("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":"")]),pageID:d([()=>g("page.path"),()=>g("page.name"),()=>g("page.pageInfo.pageInstanceId"),()=>window.dataLayer&&window.dataLayer.pages&&(window.dataLayer.pages[0]||"").pageInstanceId,()=>g("page.pageInfo.pageID")]),pageName:d([()=>g("page.name"),()=>g("page.pageInfo.pageName")]),referringURL:d([()=>g("page.pageInfo.referringUrl"),()=>g("page.pageInfo.referringURL"),()=>document.referrer]),sysEnv:d([()=>g("page.pageInfo.devEnv"),()=>g("page.pageInfo.envWork"),()=>g("page.pageInfo.sysEnv")]),variant:d([()=>g("page.pageInfo.variant"),()=>"true"==g("page.attributes.virtualPage")?"virtual page":"real page"]),version:"acdl: "+g("page.pageInfo.version")}}}function l(e){var t=[],n={},a=[],o=e.product;if(o.length>0&&"string"!=typeof o){for(var r in o)if(void 0!==o[r]&&void 0!==o[r].productInfo){var i=o[r].productInfo.productID;void 0===i&&(i="product"+(r+1)),n[i]=o[r]}Object.keys(n).forEach((e=>a.push(e))),t.push({product:n})}if(e.page&&e.page.pageInfo&&void 0!==e.page.pageInfo.pageName&&"tbd"!=e.page.pageInfo.pageName&&("page view"==e.event[0].eventInfo.eventName&&(e.page.pageInfo.reference={},e.page.pageInfo.reference.defaultProducts=[],e.page.pageInfo.reference.defaultProducts=[].concat(a)),t.push({page:e.page})),e.page&&e.page.pageInfo&&"tbd"==e.page.pageInfo.pageName&&void 0!==s("page")&&("string"!=typeof s("page")||""==s("page"))&&void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState&&void 0===window.adobeDataLayer.getState("page")){var c={};c.page=f(),"page view"==e.event[0].eventInfo.eventName&&(c.page.pageInfo.reference={},c.page.pageInfo.reference.defaultProducts=[],c.page.pageInfo.reference.defaultProducts=[].concat(a)),t.push(c)}let g={},p=e.component[0].componentInfo.componentID;g[p]=e.component[0],t.push({component:g,version:e.version});var d={},m=e.cart;if(m&&m.item.length>0&&"string"!=typeof m){("commerce"!=e.event[0].eventInfo.eventName||"cart"!=e.event[0].eventInfo.type&&"checkout"!=e.event[0].eventInfo.type)&&""==(((e||"").cart||"").cartID||"")||(d=Object.assign({},n));var l={item:d,price:e.cart.price||{},cartID:e.cart.cartID||""};t.push({cart:l})}var u={},v=e.transaction;if(v&&v.item.length>0&&"string"!=typeof v){("commerce"==e.event[0].eventInfo.eventName&&"order"==e.event[0].eventInfo.type||""!=(((e||"").transaction||"").transactionID||""))&&(u=Object.assign({},n));var h={item:u,total:e.transaction.total||{},transactionID:e.transaction.transactionID||""};t.push({transaction:h})}var y={},b={},I=e.dealer;if(I.length>0&&"string"!=typeof I){for(var r in I)void 0!==I[r]&&void 0!==I[r].dealerInfo&&(y[I[r].dealerInfo.dealerOutletBuno]=I[r]);Object.keys(y).forEach((e=>b[e]="")),t.push({dealer:y})}if(e.user.length>0&&"string"!=typeof e.user){var w={},O=e.user;for(var r in O){var N={};if(Array.isArray(O[r].profile)&&O[r].profile.length>0)for(var D in O[r].profile)N[C=null!=O[r].profile[D].profileInfo.profileID?O[r].profile[D].profileInfo.profileID:"profile"+(D+1)]=JSON.parse(JSON.stringify(O[r].profile[D]));else if(void 0===O[r].profile&&void 0!==O[r].profileInfo&&!Array.isArray(O[r].profileInfo)){var C="profile"+(r+1);N.profile={},N.profile[C]=JSON.parse(JSON.stringify(O[r].profileInfo))}var S="user"+(r+1);w[S]=JSON.parse(JSON.stringify(O[r])),w[S].profile=JSON.parse(JSON.stringify(N))}e.user=JSON.parse(JSON.stringify(w)),t.push({user:e.user})}var T={event:"page view"==e.event[0].eventInfo.eventName?"tron page view":"tron event",eventInfo:{cause:e.event[0].eventInfo.cause,effect:e.event[0].eventInfo.effect,eventAction:e.event[0].eventInfo.eventAction,eventName:e.event[0].eventInfo.eventName,eventPoints:e.event[0].eventInfo.eventPoints,timeStamp:e.event[0].eventInfo.timeStamp,type:e.event[0].eventInfo.type,category:e.event[0].category,attributes:e.event[0].attributes,reference:{linkedComponent:p,linkedProducts:a,linkedDealers:b}}};return t.push(T),t}t.default=class{constructor(){this.detectDebugMode(),this._TronVersion="5.3.0";const e=function(e){e.component={category:{componentType:"native in-page",primaryCategory:"nsc website",subCategory1:"navigation"},componentInfo:{componentName:"enhanced activity map",componentID:"enhanced activity map"},attributes:{touchpoint:"web"}},e.baseEvent={eventInfo:{cause:"default",effect:"na",eventAction:"internal click",eventName:"interaction",eventPoints:0,type:"ux"},category:{subCategory1:"",subCategory2:""},attributes:{requestedURL:""}},e.page={category:{primaryCategory:"",subCategory1:"",subCategory2:"",subCategory3:"",pageType:"tbd"},pageInfo:{pageID:"",pageName:"tbd",author:"",destinationURL:"",referringURL:"",sysEnv:"",variant:"tbd",version:"",language:"",geoRegion:""},attributes:{brand:"",timeZone:""}},e.errorMandatoryData=[],e.baseMandatoryData=[],e.baseOptionalData=["componentDEVagency","componentPlatform","vehicle[n].productID","options[n].productID"],e.productMandatoryData=[],e.productOptionalData=[],e.allowedComponentTypes=["standalone","native in-page","standalone iframe","in-page iframe"],e.allowedComponentPlatform=["aem > central","aem > local","non-aem > central","non-aem > local","aem","non-aem","local","central"]},t=function(e){e.events||(e.events={}),e.events=Object.assign(e.events,{})},n=function(e){e.defaultDatalayer={component:[{category:{},componentInfo:{},attributes:{}}],event:[{category:{},eventInfo:{},attributes:{form:{},search:[],media:{},survey:{},solutionSpecific:{}}}],custom:{},page:{category:{},pageInfo:{},attributes:{}},product:[{category:{},productInfo:{},attributes:{}}],cart:{item:[{category:{},productInfo:{},price:{attributes:{}},attributes:{}}],price:{}},transaction:{total:{attributes:{}},item:[{category:{},productInfo:{},price:{attributes:{}},attributes:{}}]},user:[{segment:{},profile:[{profileInfo:{},attributes:{}}]}],dealer:[{dealerInfo:{},attributes:{}}],version:e.version},e.events||(e.events={}),e.events.error={event:{eventInfo:{eventName:"error",type:"",eventAction:"internal click",eventPoints:"0",cause:"default",effect:"na"}},custom:{errorCode:"",errorOrigin:"",errorURL:document.location.href},mandatoryData:e.errorMandatoryData.concat(["errorAction","errorMessage","errorCause","errorType","errorCode","errorOrigin"]),optionalData:e.baseMandatoryData.concat(["errorURL"]).filter((t=>!e.errorMandatoryData.includes(t))).filter((e=>!["formLeadType","formVariant","linkLocation","ctaTarget","anchorName","hashName"].includes(e))),description:'Trigger this event whenever an error occurs that prevents the user from continuing with its journey. \n                <br> All parameters that are mandatory for every other function, are optional for error events by the code (refer to parameters listed on the right). However, please provide as much information as possible eg. vehicle, options, dealer, etc. whenever it\'s available to you at the moment the error occurred.\n                <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/1FsYrw" target="_blank">Adobe Analytics 2023 - Error Tracking confluence page</a> for further details.'},e.events=Object.assign(e.events,{activityMapClick:{event:{eventInfo:Object.assign({},JSON.parse(JSON.stringify(e.baseEvent.eventInfo)),{effect:"user clicked on an on page navigation element"})},mandatoryData:[],optionalData:["componentVersion"],description:'Trigger this event whenever the user clicks on a navigation item that does not navigate the user to a new page and hence triggers a server call.\n      <br> This is used for pure non-contextual (without vehicle, dealer, form etc context) click tracking.\n      <br>Please consult the <a href="https://atc.bmwgroup.net/confluence/x/TvwHrQ" target="_blank">Adobe Analytics 2023 - Activity Map confluence page</a> for further details.'}}),e._validErrorTypes=["backend 1st party","backend 3rd party","frontend component","user"],e._validErrorActions=e._validEventActions=["call","checkbox","component load","content closed","content opened","content visible","download","drop-down menu","first page load","form fill","internal click","outbound click","page load","radio button","rotate","item added","item removed","share","slide left","slide right","sort","suggested term","media played","media paused","media milestone reached","media stopped","email","swipe","form start intention"],e._validEventCauses=["automatic"],e.defaultValue=""};(function(e){e.genericEventName="TRON: adobeDataLayer generic event listener",e.customEventName=a.customeEventName,e._componentTrackingVersion=a.libraryName+""+a.libraryVersion,e.version=`TRON_${e._TronVersion}__${e._componentTrackingVersion}`})(this),e(this),n(this),t(this);var o=Object.keys(this).filter((e=>e.includes("allowed")));for(var r in o)this[o[r]]=this[o[r]].map((e=>e.toLowerCase()));this._createPublicMethods(),this.message={}}getSupportedEvents(){var e={};for(const d in this.events){var t=JSON.parse(JSON.stringify(this.events[d].mandatoryData)),n=JSON.parse(JSON.stringify(this.events[d].optionalData)),a=Object.keys(this).map((e=>e.toLowerCase())),o=[t.sort(),n.sort()];for(var r in o)for(var i in o[r]){var s=o[r][i];s=s.indexOf("[n].")>-1?s.replace("[n].",""):s;var c=a.filter((e=>e.includes(s.toLowerCase())));if(("string"==typeof s&&1==c.length||"string"==typeof s&&c.length>1&&c[0].includes(s))&&["optionscode"].indexOf(s)<0&&Array.isArray(this[Object.keys(this)[a.indexOf(c[0])]])){var g=this[Object.keys(this)[a.indexOf(c[0])]],p="Possible Options: "+(g=g.filter((function(e){return""!==e}))).join(", ").toString();o[r][i]='<span style="color: #1000ff;font-weight: bold;" title="'+p+'">'+o[r][i]+"</span>"}}e[d]={description:this.events[d].description,"mandatory parameters":o[0].join(", <br>").toString(),"optional parameters":o[1].join(", <br>").toString()}}return e}setDebug(e){if("boolean"!=typeof e)return!1;sessionStorage.setItem("tronDebug",e),this.debug=e}detectDebugMode(){let e;null!=sessionStorage.getItem("tronDebug")&&(e="true"===sessionStorage.getItem("tronDebug")),-1!=document.location.search.indexOf("trondebug")&&(e=-1!=document.location.search.indexOf("trondebug=true"),sessionStorage.setItem("tronDebug",e)),this.setDebug(e)}_createPublicMethods(e){for(const e in this.events)this[e]=function(e){return function(t){this._processEvent(`${e}`,t)}}(e)}flattenObject(e){var t={};for(var n in e)if(e.hasOwnProperty(n))if("object"==typeof e[n]&&null!==e[n]){var a=this.flattenObject(e[n]);for(var o in a)a.hasOwnProperty(o)&&(t[n+"."+o]=a[o])}else t[n]=e[n];return t}_checkParamsPassed(e,t){t=this.flattenObject(t),t=(t=Object.keys(t)).map((function(e){return e.replace(/(.)(\d+)(.)/,"[n].")}));var n=[];for(var a in this.events)n.push.apply(n,this.events[a].mandatoryData),n.push.apply(n,this.events[a].optionalData);for(var a in n=n.filter(((e,t,n)=>n.indexOf(e)===t)),t)n.indexOf(t[a])<0&&this._throwError("o",t[a],"not-defined","")}_processEvent(e,t){void 0===t&&(t={}),TRON.currentEventName=e,TRON.prefix=a.prefix,TRON.componentName=a.libraryName||((this.component||"").componentInfo||"").componentName||"",void 0!==t&&(void 0!==t.componentName&&(TRON.componentName=t.componentName),void 0!==t.formOrigin&&(TRON.componentName=t.formOrigin),void 0!==t.componentDEVagency&&(TRON.componentName=TRON.componentName+" "+t.componentDEVagency)),TRON.version=this.version;var n=`${m()}/${d([()=>window.location.href.split("country=")[1].split("&")[0],()=>window.location.href.split("country_origin=")[1].split("&")[0],()=>g("page.pageInfo.geoRegion"),()=>g("page.pageInfo.language").indexOf("-")>-1&&g("page.pageInfo.language").split("-")[1],()=>window.location.host.indexOf("bmwusa")>-1?"US":"",()=>void 0!==t&&void 0!==t.pageGeoRegion&&t.pageGeoRegion.toLowerCase()])}_${d([()=>g("page.pageInfo.language").slice(0,2)||(g("page.pageInfo.language").indexOf("-")>-1?g("page.pageInfo.language").split("-")[0]:window.location.host.indexOf("bmwusa")>-1?"en":void 0!==t&&void 0!==t.pageLanguage?t.pageLanguage.toLowerCase():"")])}/${TRON.componentName}`;TRON.dataComponent=[{category:{componentType:this.component.category.componentType||"",primaryCategory:this.component.category.primaryCategory||"",subCategory1:this.component.category.subCategory1||""},componentInfo:{componentName:TRON.componentName,componentID:n},attributes:{touchpoint:this.component.attributes.touchpoint||""}}];var o=JSON.parse(JSON.stringify(t));this._debug("ðŸ’¡ event triggered:"+e,o),this._checkParamsPassed(e,o),this.message=this._loadEventData(e,t);try{this._checkmandatoryData(e,t),this.events[e].optionalData&&this._checkOptionalData(e,t)}catch(e){return!1}var r=a.prefix;this._validateProperty("componentType",this.allowedComponentTypes,e,t),this._validateProperty("componentName",this.allowedComponentNames,e,t),this._validateProperty("componentSubCat1",this.allowedComponentSubCat1,e,t),this._validateProperty("componentPlatform",this.allowedComponentPlatform,e,t),void 0!==t.componentType?this.message.component[0].category.componentType=t.componentType:this.message.component[0].category.componentType=((this.component||"").category||"").componentType||"",void 0!==t.componentSubCat1?this.message.component[0].category.subCategory1=t.componentSubCat1:this.message.component[0].category.subCategory1=((this.component||"").category||"").subCategory1||"",void 0!==t.componentVersion&&(this.message.component[0].attributes.componentVersion=["componentVersion"],delete this.message.custom.componentVersion),void 0===this.message.component[0].componentInfo&&(this.message.component[0].componentInfo={}),void 0!==t.componentName?(this.message.component[0].componentInfo.componentName=t.componentName,this.message.event[0].category.primaryCategory=t.componentName):(this.message.component[0].componentInfo.componentName=this.message.component[0].componentInfo.componentName,this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName),void 0!==t.componentDEVagency&&(this.message.component[0].attributes.componentDEVagency=t.componentDEVagency),void 0!==t.componentPlatform&&(this.message.component[0].attributes.platform=t.componentPlatform);var i=void 0!==r?r:TRON.prefix,c={"con >":"configurator","stock >":"stock locator","sales >":"sales","fin >":"finance","rent >":"rental"},p=void 0!==c[i]?c[i]:((((this.message||"").component||"")[0]||"").category||"").primaryCategory||"";if(""==p||"shared > "==i||"local > "==i)if([".bmw.",".mini.",".bmw-motorrad.",".bmwusa.com","customer.bmwgroup.com"].some((e=>window.location.href.includes(e))))if([".bmw.com"].some((e=>window.location.href.includes(e)))){var l=window.location.pathname.split("/");void 0!==l[1]&&"nsc website"==(p=l[1].indexOf("-")>-1?"nsc website":"special website")&&(i="nsc > ")}else p="special website",i="special > ";else p="special website",i="special > ";if(void 0!==r&&(r=i),void 0!==TRON.prefix&&(TRON.prefix=i),this.message.component[0].category.primaryCategory=p,void 0!==t&&t.componentVersion&&(this.message.component[0].attributes.componentVersion=t.componentVersion),this.message.event[0].category.primaryCategory=this.message.component[0].componentInfo.componentName,void 0!==t&&(this.message.component[0].componentInfo.componentID=m(),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.pageGeoRegion?t.pageGeoRegion:"")||g("page.pageInfo.geoRegion")||""),this.message.component[0].componentInfo.componentID+=" > "+((void 0!==t.componentName?t.componentName:"")||this.message.component[0].componentInfo.componentName),"form"==this.message.event[0].eventInfo.eventName&&(this.message.component[0].componentInfo.componentID+=" "+(void 0!==t.formType?t.formType:""))),void 0!==this.message.event[0].eventInfo.effect&&(this.message.event[0].eventInfo.effect=(r||"")+this.message.event[0].eventInfo.effect,this.message.event[0].eventInfo.timeStamp=this.message.event[0].timeStamp,delete this.message.event[0].timeStamp),"aem page loaded"!=(((window.adobeDataLayer||"")[0]||"").event||"")&&"page view"!=this.message.event[0].eventInfo.eventName&&(void 0===s("page")||"string"==typeof s("page")&&""!=s("page")||(this.message.page=f())),this.message.product.length>0){var u=[];for(var v in this.message.product)if(void 0!==this.message.product[v]&&void 0!==this.message.product[v].productInfo){var h=this.message.product[v].productInfo.productID;void 0===h&&(h="product"+(v+1)),u.push(h)}this.message.page.pageInfo.reference={},this.message.page.pageInfo.reference.defaultProducts=[],this.message.page.pageInfo.reference.defaultProducts=[].concat(u)}if(void 0!==t&&void 0===t.user)if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState){var y=window.adobeDataLayer.getState();if(void 0!==y.user&&Object.keys(y.user).length>0)for(var v in this.message.user=[],y.user)this.message.user.push(y.user[v])}else void 0!==s("user")&&"string"!=typeof s("user")&&(this.message.user=s("user"));if(void 0!==t&&void 0===t.dealer)if(void 0!==window.adobeDataLayer&&void 0!==window.adobeDataLayer.getState){var b=window.adobeDataLayer.getState();if(void 0!==b.dealer&&Object.keys(b.dealer).length>0)for(var v in this.message.dealer=[],b.dealer)this.message.dealer.push(b.dealer[v])}else void 0!==s("dealer")&&"string"!=typeof s("dealer")&&(this.message.dealer=s("dealer"));"error"==this.message.event[0].eventInfo.eventName&&(this.message.event[0].eventInfo.effect=void 0!==t.errorMessage?(r||"")+t.errorMessage:"",void 0!==t.errorAction&&(this.message.event[0].eventInfo.eventAction=t.errorAction),void 0!==t.errorCause&&(this.message.event[0].eventInfo.cause=t.errorCause),void 0!==t.errorType&&(this.message.event[0].eventInfo.type=t.errorType),this.message.event[0].category.primaryCategory=t.componentName||this.message.component[0].componentInfo.componentName,void 0!==t.errorCode&&(this.message.event[0].category.subCategory1=t.errorCode),void 0!==t.errorOrigin&&(this.message.event[0].category.subCategory2=t.errorOrigin),void 0!==t.errorURL&&(this.message.event[0].attributes.requestedURL=t.errorURL),delete this.message.event[0].type,delete this.message.event[0].action,delete this.message.event[0].cause,delete this.message.event[0].effect),t.eventCause&&null!=t.eventCause&&(this.message.event[0].eventInfo.cause=t.eventCause),void 0===t.eventAction||"item added"!=this.message.event[0].eventInfo.eventAction&&"item removed"!=this.message.event[0].eventInfo.eventAction&&"form start intention"!=this.message.event[0].eventInfo.eventAction?void 0!==t.eventAction&&"item added"!==this.message.event[0].eventInfo.eventAction&&"item removed"!==this.message.event[0].eventInfo.eventAction&&"form start intention"!==this.message.event[0].eventInfo.eventAction&&(this.message.event[0].eventInfo.eventAction=t.eventAction):this._throwError("o",this.message.event[0].eventInfo.eventAction,"specific case",""),this.message.event[0].eventInfo.effect=this.message.event[0].eventInfo.effect.toLowerCase(),this.message.component[0].componentInfo.componentID=(((this.message.page||"").attributes||"").brand||"")+"/"+(((this.message.page||"").pageInfo||"").geoRegion||"")+"_"+(((this.message.page||"").pageInfo||"").language||"")+"/"+this.message.component[0].componentInfo.componentName,void 0!==this.message.page.pageInfo.pageID&&(this.message.page.pageInfo.pageID="/"+(this.message.page.category.pageType||"")+"/"+this.message.page.attributes.brand+"/"+this.message.page.pageInfo.geoRegion+"/"+this.message.page.pageInfo.language+"/"+this.message.page.category.primaryCategory+"/",void 0!==this.message.page.category.subCategory1&&""!=this.message.page.category.subCategory1&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory1+"/"),void 0!==this.message.page.category.subCategory2&&""!=this.message.page.category.subCategory2&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory2+"/"),void 0!==this.message.page.category.subCategory3&&""!=this.message.page.category.subCategory3&&(this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+this.message.page.category.subCategory3+"/"),this.message.page.pageInfo.pageID=this.message.page.pageInfo.pageID+(void 0!==this.message.page.pageInfo.pageName&&this.message.page.pageInfo.pageName.indexOf(">")>-1&&this.message.page.pageInfo.pageName.split(" > ").length>0&&this.message.page.pageInfo.pageName.split(" > ")[1]||this.message.page.pageInfo.pageName)),this._debug("ðŸ’² payload created",this.message),this._sendMessage()}_checkmandatoryData(e,t){let n,a=this.events[e].mandatoryData,o=!0,r="";for(let e=0;e<a.length;e++){let i,s=a[e];if(s.indexOf("[n]")>-1){let e=s.split("[n]");r=e[1].replace(".",""),i=t[e[0]]&&t[e[0]][0][r]}else i=t[s];if(void 0===i)switch(s){case"componentType":i=this.component.category.componentType;break;case"componentName":i=this.component.componentInfo.componentName;break;case"componentSubCat1":i=this.component.category.subCategory01}n=this._checkValidValue("mandatory",s,r,i),0==n&&(o=!1)}if(0==o)throw new SyntaxError;return!0}_checkOptionalData(e,t){let n,a=this.events[e].optionalData,o=!0,r="";for(let e=0;e<a.length;e++){let i,s=a[e];if(s.indexOf("[n]")>-1){let e=s.split("[n]");t[e[0]]&&t[e[0]].length>0&&(r=e[1].replace(".",""),i=t[e[0]][0][r],i&&""==i&&errArrayVal.push(s))}else i=t[s];void 0===i&&void 0===t[s]||(n=this._checkValidValue("optional",s,r,i),0==n&&(s.indexOf("[n]")>-1?t[s.split("[n]")[0]][0][s.split("[n]")[1].replace(".","")]="":t[s]="",o=!1))}return!0}_checkValidValue(e,t,n,a){let o=!0,r=Object.keys(this).map((e=>e.toLowerCase()));n=""!=n&&t.indexOf("[n]")>-1?t.replace("[n].",""):t;let i=r.filter((e=>e.includes(n.toLowerCase()))),s="object"==typeof this[Object.keys(this)[r.indexOf(i[0])]]?this[Object.keys(this)[r.indexOf(i[0])]]:[];if(s=s.filter((function(e){return""!==e})),(void 0===(a="string"==typeof a?(a||"").toLowerCase():a)||null==a)&&"mandatory"==e){if(["vehicle[n].range"].indexOf(t)>-1)return!0;this._throwError("m",t,"missing",""),o=!1}if("string"==typeof a&&0==a.trim().length&&"mandatory"==e&&(this._throwError("m",t,"empty",s),o=!1),Array.isArray(s)&&s.length>0&&!s.includes(a)&&("string"==typeof a&&a.trim().length>0||null==a||""==a||void 0===a)&&1==o){if(t.indexOf("vehicle")>-1&&(t=t.split(".")[1],["codeAG","codeVG","range","rangeVG"].indexOf(t)>-1))return!0;if(["formLeadType","formComChannel","dealer[n].selectionState","options[n].code","options[n].codeVG","options[n].category1","pageGeoRegion","pageLanguage","vehicle[n].range","pageSubCat1"].indexOf(t)>-1&&void 0!==a)return!0;if(1==s.length&&"value should be numeric"==s[0])return!0;"mandatory"==e?(this._throwError("m",t,"incorrect",s),o=!1):"optional"==e&&(this._throwError("o",t,"incorrect",s),o=!1)}return o}_loadEventData(e,t){const n=Object.assign({},JSON.parse(JSON.stringify(this.defaultDatalayer)));n.component[0]=Object.assign({},JSON.parse(JSON.stringify(this.component)));const o=JSON.parse(JSON.stringify(this.defaultDatalayer.event[0])),r=JSON.parse(JSON.stringify(this.baseEvent)),i=JSON.parse(JSON.stringify(this.events[e].event));n.event[0]=[o,r,i].reduce(this._deepMerge.bind(this),{}),n.event[0].timeStamp=(new Date).getTime(),a.pageExist&&void 0!==n.page&&(this.events[e].page?n.page=Object.assign({},JSON.parse(JSON.stringify(this.page)),JSON.parse(JSON.stringify(this.events[e].page))):n.page=Object.assign({},JSON.parse(JSON.stringify(this.page)))),a.projConditionCheck&&a.projectCondition(this,e,t),this.events[e].custom=this.events[e].custom?this.events[e].custom:{};const s=JSON.parse(JSON.stringify(this.baseCustom||{})),c=JSON.parse(JSON.stringify(this.events[e].custom));return n.custom=[s,c].reduce(this._deepMerge.bind(this),{}),n.version="tron_"+this._TronVersion+"__"+this._componentTrackingVersion,n}_throwError(e,t,n,a,o){const r="m"===e?"Incorrect TRON implementation: â›” ":"Incorrect TRON implementation: âš ï¸ ";let i="";switch(a=""!=a?a.reduce(((e,t)=>`${e},${t}`)):a,n){case"not-defined":i+=`Parameter ${t} not defined in the library, hence this value cannot be tracked. The remaining data will be tracked. Please remove this parameter. ${o||""}`;break;case"specific case":["item added","item removed","form start intention"].includes(t)&&(i+=`since eventInfo.eventAction = 'item added' or 'item removed' or 'form start intention', it cannot be overwritten with eventAction value ${o||""}`);break;case"missing":i+=`parameter is missing, hence this event cannot be tracked. Please provide the parameter ${o||""}: ${t}`;break;case"empty":i+=`${t} value is empty, hence this event cannot be tracked. Pick a standard value Please provide a valid value ${o||""}: ${a}`;break;case"incorrect":i+=`${t} value is incorrect, hence this value cannot be tracked. The remaining data will be tracked. Pick a standard value ${o||""}: ${a}`;break;case"incorrect-numeric":i+=`${t} value is incorrect, hence this value cannot be tracked. Please send a numeric value ${o||""}`;break;case"eventMessage":i+=`custom event created was not sent, hence this event cannot be tracked. Please check the error ${o||""}:`;break;case"nonValidFunction":i+=`this function ${t} does not exist, hence this event cannot be tracked. Please make sure to use a correct reference name. ${o||""} Error Details: ${a}`}i=r+i,"m"===e?console.error(i):"o"==e&&console.warn(i)}_validateProperty(e,t,n,a,o=!1){if(a&&a[e]&&null!=typeof a[e]){let r=a[e];if(!t.includes(r)){if(this.events[n].mandatoryData.indexOf(e)>-1||1==o)return void this._throwError("m",e,"incorrect",t);this._throwError("o",e,"incorrect",t),a[e]=""}}}_debug(e,t){this.debug&&console.info(this.version,"\r\n",e,"\r\n",t)}_sendMessage(){this._debug("âŒ› sending data..."),this.message.component[0].category.componentType.indexOf("iframe")>-1?this._sendPostMessage():(this._sendCustomEvent(),this._sendGenericEvent()),this.message={}}_sendCustomEvent(){let e=!1;try{e=new CustomEvent(this.customEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("âœ… custom event successfully sent",e)}_sendGenericEvent(){let e=!1;try{e=new CustomEvent(this.genericEventName,JSON.parse(JSON.stringify({detail:this.message}))),window.dispatchEvent(e)}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("âœ… generic event successfully sent",e)}_sendPostMessage(){let e=!1;try{var t=l(this.message);e=JSON.parse(JSON.stringify({methodName:"TRON: postMessage",detail:t,type:"TRON: generic iframe event listener"})),window.top.postMessage(JSON.stringify(e),"*")}catch(e){return this._throwError("m","custom event","eventMessage",[e]),!1}this._debug("âœ… postmessage successful sent",e)}_deepMerge(e,t){return Object.entries(t).forEach((([t,n])=>{n&&"object"==typeof n?this._deepMerge(e[t]=e[t]||{},n):e[t]=n})),e}},window.onerror=function(){if(arguments.length>0&&"string"==typeof arguments[0]&&arguments[0].indexOf("Uncaught TypeError: ")>-1&&arguments[0].indexOf("not a function")>-1){var e=arguments[0].split("Uncaught TypeError: ")[1].split("is not a function")[0];return console.error("Incorrect TRON implementation: â›” this function "+e+" does not exist , hence this event cannot be tracked. Please make sure to use a correct reference name!","\n","Error occurred at:",arguments),!0}return!1},TRON.isInitialized||(window.addEventListener("TRON: adobeDataLayer generic event listener",(function(e){window.tronDetailDL=e.detail,window.adobeDataLayer=window.adobeDataLayer||[];for(var t=l(tronDetailDL),n={},a=0;a<t.length;a++)for(var o=t[a],r=Object.keys(o),i=0;i<r.length;i++){var s=r[i];n[s]=o[s]}window.adobeDataLayer.push(n)})),TRON.isInitialized=!0)},266:function(e,t,n){var a,o;a=[t,n(924)],void 0===(o=function(e,n){"use strict";var a;Object.defineProperty(e,"__esModule",{value:!0}),t.default=void 0;var o=(n=(a=n)&&a.__esModule?a:{default:a}).default;t.default=o}.apply(t,a))||(e.exports=o)}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}return n.d=function(e,t){for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n(266)}()}));